import { createContext, useContext, useState, useCallback, type ReactNode } from "react";

export type Language = "en" | "fr" | "ar";

type Translations = Record<string, Record<string, string>>;

const translations: Translations = {
  en: {
    "nav.howItWorks": "How It Works",
    "nav.subjects": "Subjects",
    "nav.features": "Features",
    "nav.signIn": "Sign In",
    "nav.dashboard": "Go to Dashboard",
    "hero.badge": "AI-Powered Tutoring",
    "hero.title": "Your AI Tutor for the",
    "hero.titleHighlight": "Mauritanian BAC",
    "hero.subtitle": "مدرسك الذكي لباكالوريا موريتانيا",
    "hero.description": "Get step-by-step explanations from your official IPN textbooks, powered by AI. Study smarter, not harder.",
    "hero.startLearning": "Start Learning",
    "hero.seeHow": "See How It Works",
    "stats.pagesIndexed": "Pages Indexed",
    "stats.subjects": "Subjects",
    "stats.available": "Available",
    "howItWorks.title": "How It Works",
    "howItWorks.description": "Three simple steps to start learning with AI-powered tutoring.",
    "howItWorks.step1.title": "Upload & Index",
    "howItWorks.step1.description": "Admins upload official BAC textbooks. AI reads and indexes every page.",
    "howItWorks.step2.title": "Ask Questions",
    "howItWorks.step2.description": "Ask any question about your BAC curriculum in French or Arabic.",
    "howItWorks.step3.title": "Learn Step-by-Step",
    "howItWorks.step3.description": "Get detailed explanations with page references from your textbooks.",
    "subjects.title": "BAC Subjects Covered",
    "subjects.description": "Comprehensive coverage of all major BAC subjects with AI-powered explanations.",
    "subjects.math.name": "Mathematics",
    "subjects.math.description": "Algebra, calculus, geometry and statistics for the BAC exam.",
    "subjects.physics.name": "Physics-Chemistry",
    "subjects.physics.description": "Mechanics, thermodynamics, optics and chemical reactions.",
    "subjects.science.name": "Natural Sciences",
    "subjects.science.description": "Biology, geology and environmental sciences curriculum.",
    "subjects.philosophy.name": "Philosophy",
    "subjects.philosophy.description": "Ethics, logic, epistemology and political philosophy.",
    "subjects.french.name": "French",
    "subjects.french.description": "Literature analysis, grammar, and dissertation methodology.",
    "subjects.arabic.name": "Arabic",
    "subjects.arabic.description": "Literature, grammar, rhetoric and texts.",
    "features.title": "Built for BAC Success",
    "features.description": "Every feature is designed to help you prepare effectively for your exams.",
    "features.rag.title": "RAG-Powered Answers",
    "features.rag.description": "Answers grounded in your official textbooks, not hallucinations.",
    "features.steps.title": "Step-by-Step Explanations",
    "features.steps.description": "Every concept broken down into digestible steps.",
    "features.citations.title": "Source Citations",
    "features.citations.description": "See exactly which textbook page each answer comes from.",
    "features.exam.title": "Exam-Focused",
    "features.exam.description": "Tutor optimized for BAC exam preparation and scoring.",
    "cta.title": "Ready to ace your BAC?",
    "cta.subtitle": "باك مار - نجاحك يبدأ هنا",
    "cta.button": "Get Started Now",
    "footer.tagline": "AI-Powered Tutoring for Mauritania",
    "footer.builtBy": "Built by",
    "footer.allRights": "All rights reserved.",
    "loading": "Loading...",
    "chat.newSession": "New Session",
    "chat.noSessions": "No sessions yet",
    "chat.allSubjects": "All Subjects",
    "chat.newChat": "New Chat",
    "chat.home": "Home",
    "chat.loading": "Loading...",
    "chat.greeting": "How can I help you today?",
    "chat.greetingDesc": "Ask me anything about your BAC curriculum. I'll provide step-by-step explanations with references from your official textbooks.",
    "chat.placeholder": "Ask about your BAC curriculum...",
    "chat.disclaimer": "AI can make mistakes. Verify with your official IPN textbook.",
    "chat.allLevels": "All Levels",
    "chat.elementary": "Elementary",
    "chat.secondary": "Secondary",
    "chat.highSchool": "High School",
    "chat.allTextbooks": "All Textbooks",
    "chat.allChapters": "All Chapters",
    "chat.curriculumContext": "Curriculum Context",
    "chat.sourceMaterial": "Source Material",
    "chat.noSourcesYet": "Ask a question to see source references here.",
    "chat.pages": "Pages",
    "chat.currentChapter": "Current Chapter",
    "chat.selectTopic": "Select a topic",
    "chat.exploring": "Exploring:",
    "chat.startConversation": "Start a conversation to track progress",
    "chat.keyFormulas": "Key Formulas",
    "chat.examTip": "Exam Tip",
    "chat.examTipText": "Always show your working steps in the BAC exam. Partial marks are awarded for correct methodology even if the final answer is wrong.",
    "chat.suggestNewton": "Explain Newton's Second Law",
    "chat.suggestDNA": "What is DNA replication?",
    "chat.suggestComplex": "Solve a complex number equation",
    "chat.suggestPhotosynthesis": "Explain photosynthesis",
    "chat.today": "Today",
    "chat.yesterday": "Yesterday",
    "chat.previousDays": "Previous 7 Days",
    "chat.older": "Older",
  },
  fr: {
    "nav.howItWorks": "Comment ça marche",
    "nav.subjects": "Matières",
    "nav.features": "Fonctionnalités",
    "nav.signIn": "Se connecter",
    "nav.dashboard": "Aller au tableau de bord",
    "hero.badge": "Tutorat propulsé par l'IA",
    "hero.title": "Votre tuteur IA pour le",
    "hero.titleHighlight": "BAC Mauritanien",
    "hero.subtitle": "Votre tuteur intelligent pour le BAC mauritanien",
    "hero.description": "Obtenez des explications étape par étape de vos manuels IPN officiels, propulsées par l'IA. Étudiez plus intelligemment.",
    "hero.startLearning": "Commencer",
    "hero.seeHow": "Voir comment ça marche",
    "stats.pagesIndexed": "Pages indexées",
    "stats.subjects": "Matières",
    "stats.available": "Disponible",
    "howItWorks.title": "Comment ça marche",
    "howItWorks.description": "Trois étapes simples pour commencer à apprendre avec le tutorat IA.",
    "howItWorks.step1.title": "Télécharger et indexer",
    "howItWorks.step1.description": "Les administrateurs téléchargent les manuels BAC officiels. L'IA lit et indexe chaque page.",
    "howItWorks.step2.title": "Poser des questions",
    "howItWorks.step2.description": "Posez n'importe quelle question sur votre programme BAC en français ou en arabe.",
    "howItWorks.step3.title": "Apprendre étape par étape",
    "howItWorks.step3.description": "Obtenez des explications détaillées avec des références de pages de vos manuels.",
    "subjects.title": "Matières du BAC couvertes",
    "subjects.description": "Couverture complète de toutes les matières principales du BAC avec des explications IA.",
    "subjects.math.name": "Mathématiques",
    "subjects.math.description": "Algèbre, calcul, géométrie et statistiques pour l'examen du BAC.",
    "subjects.physics.name": "Physique-Chimie",
    "subjects.physics.description": "Mécanique, thermodynamique, optique et réactions chimiques.",
    "subjects.science.name": "Sciences Naturelles",
    "subjects.science.description": "Biologie, géologie et programme de sciences de l'environnement.",
    "subjects.philosophy.name": "Philosophie",
    "subjects.philosophy.description": "Éthique, logique, épistémologie et philosophie politique.",
    "subjects.french.name": "Français",
    "subjects.french.description": "Analyse littéraire, grammaire et méthodologie de dissertation.",
    "subjects.arabic.name": "Arabe",
    "subjects.arabic.description": "Littérature, grammaire, rhétorique et textes.",
    "features.title": "Conçu pour réussir le BAC",
    "features.description": "Chaque fonctionnalité est conçue pour vous aider à préparer efficacement vos examens.",
    "features.rag.title": "Réponses RAG",
    "features.rag.description": "Des réponses basées sur vos manuels officiels, pas des hallucinations.",
    "features.steps.title": "Explications étape par étape",
    "features.steps.description": "Chaque concept décomposé en étapes compréhensibles.",
    "features.citations.title": "Citations des sources",
    "features.citations.description": "Voyez exactement de quelle page de manuel provient chaque réponse.",
    "features.exam.title": "Axé sur l'examen",
    "features.exam.description": "Tuteur optimisé pour la préparation et la réussite de l'examen du BAC.",
    "cta.title": "Prêt à réussir votre BAC ?",
    "cta.subtitle": "BAC MAR - Votre succès commence ici",
    "cta.button": "Commencer maintenant",
    "footer.tagline": "Tutorat IA pour la Mauritanie",
    "footer.builtBy": "Créé par",
    "footer.allRights": "Tous droits réservés.",
    "loading": "Chargement...",
    "chat.newSession": "Nouvelle session",
    "chat.noSessions": "Aucune session",
    "chat.allSubjects": "Toutes les matières",
    "chat.newChat": "Nouveau chat",
    "chat.home": "Accueil",
    "chat.loading": "Chargement...",
    "chat.greeting": "Comment puis-je vous aider ?",
    "chat.greetingDesc": "Posez-moi n'importe quelle question sur votre programme BAC. Je fournirai des explications étape par étape avec des références de vos manuels officiels.",
    "chat.placeholder": "Posez une question sur le programme BAC...",
    "chat.disclaimer": "L'IA peut faire des erreurs. Vérifiez avec votre manuel IPN officiel.",
    "chat.allLevels": "Tous les niveaux",
    "chat.elementary": "Primaire",
    "chat.secondary": "Secondaire",
    "chat.highSchool": "Lycée",
    "chat.allTextbooks": "Tous les manuels",
    "chat.allChapters": "Tous les chapitres",
    "chat.curriculumContext": "Contexte du programme",
    "chat.sourceMaterial": "Matériel source",
    "chat.noSourcesYet": "Posez une question pour voir les références ici.",
    "chat.pages": "Pages",
    "chat.currentChapter": "Chapitre actuel",
    "chat.selectTopic": "Sélectionner un sujet",
    "chat.exploring": "Exploration :",
    "chat.startConversation": "Commencez une conversation pour suivre la progression",
    "chat.keyFormulas": "Formules clés",
    "chat.examTip": "Conseil d'examen",
    "chat.examTipText": "Montrez toujours vos étapes de travail au BAC. Des points partiels sont accordés pour une méthodologie correcte même si la réponse finale est fausse.",
    "chat.suggestNewton": "Expliquez la deuxième loi de Newton",
    "chat.suggestDNA": "Qu'est-ce que la réplication de l'ADN ?",
    "chat.suggestComplex": "Résoudre une équation de nombres complexes",
    "chat.suggestPhotosynthesis": "Expliquer la photosynthèse",
    "chat.today": "Aujourd'hui",
    "chat.yesterday": "Hier",
    "chat.previousDays": "7 derniers jours",
    "chat.older": "Plus ancien",
  },
  ar: {
    "nav.howItWorks": "كيف يعمل",
    "nav.subjects": "المواد",
    "nav.features": "المميزات",
    "nav.signIn": "تسجيل الدخول",
    "nav.dashboard": "الذهاب إلى لوحة التحكم",
    "hero.badge": "تعليم مدعوم بالذكاء الاصطناعي",
    "hero.title": "معلمك الذكي لـ",
    "hero.titleHighlight": "البكالوريا الموريتانية",
    "hero.subtitle": "مدرسك الذكي لباكالوريا موريتانيا",
    "hero.description": "احصل على شروحات خطوة بخطوة من كتبك المدرسية الرسمية، مدعومة بالذكاء الاصطناعي.",
    "hero.startLearning": "ابدأ التعلم",
    "hero.seeHow": "شاهد كيف يعمل",
    "stats.pagesIndexed": "صفحات مفهرسة",
    "stats.subjects": "مواد",
    "stats.available": "متاح",
    "howItWorks.title": "كيف يعمل",
    "howItWorks.description": "ثلاث خطوات بسيطة للبدء في التعلم مع التدريس بالذكاء الاصطناعي.",
    "howItWorks.step1.title": "رفع وفهرسة",
    "howItWorks.step1.description": "يقوم المشرفون برفع الكتب المدرسية الرسمية. يقرأ الذكاء الاصطناعي ويفهرس كل صفحة.",
    "howItWorks.step2.title": "اطرح الأسئلة",
    "howItWorks.step2.description": "اطرح أي سؤال حول منهج البكالوريا بالفرنسية أو العربية.",
    "howItWorks.step3.title": "تعلم خطوة بخطوة",
    "howItWorks.step3.description": "احصل على شروحات مفصلة مع مراجع الصفحات من كتبك.",
    "subjects.title": "مواد البكالوريا المغطاة",
    "subjects.description": "تغطية شاملة لجميع مواد البكالوريا الرئيسية مع شروحات بالذكاء الاصطناعي.",
    "subjects.math.name": "الرياضيات",
    "subjects.math.description": "الجبر والتفاضل والهندسة والإحصاء لامتحان البكالوريا.",
    "subjects.physics.name": "الفيزياء والكيمياء",
    "subjects.physics.description": "الميكانيكا والديناميكا الحرارية والبصريات والتفاعلات الكيميائية.",
    "subjects.science.name": "العلوم الطبيعية",
    "subjects.science.description": "البيولوجيا والجيولوجيا وعلوم البيئة.",
    "subjects.philosophy.name": "الفلسفة",
    "subjects.philosophy.description": "الأخلاق والمنطق ونظرية المعرفة والفلسفة السياسية.",
    "subjects.french.name": "الفرنسية",
    "subjects.french.description": "تحليل الأدب والقواعد ومنهجية المقال.",
    "subjects.arabic.name": "العربية",
    "subjects.arabic.description": "الأدب والنحو والبلاغة والنصوص",
    "features.title": "مصمم لنجاح البكالوريا",
    "features.description": "كل ميزة مصممة لمساعدتك في التحضير الفعال لامتحاناتك.",
    "features.rag.title": "إجابات مدعومة بالاسترجاع",
    "features.rag.description": "إجابات مبنية على كتبك المدرسية الرسمية، وليست هلوسات.",
    "features.steps.title": "شروحات خطوة بخطوة",
    "features.steps.description": "كل مفهوم مقسم إلى خطوات سهلة الفهم.",
    "features.citations.title": "الاستشهاد بالمصادر",
    "features.citations.description": "شاهد بالضبط من أي صفحة في الكتاب تأتي كل إجابة.",
    "features.exam.title": "مركز على الامتحان",
    "features.exam.description": "معلم محسّن للتحضير لامتحان البكالوريا والنجاح فيه.",
    "cta.title": "هل أنت مستعد للتفوق في البكالوريا؟",
    "cta.subtitle": "باك مار - نجاحك يبدأ هنا",
    "cta.button": "ابدأ الآن",
    "footer.tagline": "تعليم بالذكاء الاصطناعي لموريتانيا",
    "footer.builtBy": "صنع بواسطة",
    "footer.allRights": "جميع الحقوق محفوظة.",
    "loading": "جاري التحميل...",
    "chat.newSession": "جلسة جديدة",
    "chat.noSessions": "لا توجد جلسات بعد",
    "chat.allSubjects": "جميع المواد",
    "chat.newChat": "محادثة جديدة",
    "chat.home": "الرئيسية",
    "chat.loading": "جاري التحميل...",
    "chat.greeting": "كيف يمكنني مساعدتك اليوم؟",
    "chat.greetingDesc": "اسألني أي سؤال عن منهج البكالوريا. سأقدم شروحات خطوة بخطوة مع مراجع من كتبك المدرسية الرسمية.",
    "chat.placeholder": "اسأل عن منهج البكالوريا...",
    "chat.disclaimer": "قد يخطئ الذكاء الاصطناعي. تحقق من كتابك المدرسي الرسمي.",
    "chat.allLevels": "جميع المستويات",
    "chat.elementary": "ابتدائي",
    "chat.secondary": "إعدادي",
    "chat.highSchool": "ثانوي",
    "chat.allTextbooks": "جميع الكتب",
    "chat.allChapters": "جميع الفصول",
    "chat.curriculumContext": "سياق المنهج",
    "chat.sourceMaterial": "المصادر",
    "chat.noSourcesYet": "اطرح سؤالاً لرؤية المراجع هنا.",
    "chat.pages": "الصفحات",
    "chat.currentChapter": "الفصل الحالي",
    "chat.selectTopic": "اختر موضوعاً",
    "chat.exploring": "استكشاف:",
    "chat.startConversation": "ابدأ محادثة لتتبع التقدم",
    "chat.keyFormulas": "الصيغ الأساسية",
    "chat.examTip": "نصيحة للامتحان",
    "chat.examTipText": "اعرض دائماً خطوات عملك في امتحان البكالوريا. تُمنح درجات جزئية للمنهجية الصحيحة حتى لو كانت الإجابة النهائية خاطئة.",
    "chat.suggestNewton": "اشرح قانون نيوتن الثاني",
    "chat.suggestDNA": "ما هو تكرار الحمض النووي؟",
    "chat.suggestComplex": "حل معادلة أعداد مركبة",
    "chat.suggestPhotosynthesis": "اشرح عملية التمثيل الضوئي",
    "chat.today": "اليوم",
    "chat.yesterday": "أمس",
    "chat.previousDays": "آخر 7 أيام",
    "chat.older": "أقدم",
  },
};

interface LanguageContextType {
  language: Language;
  setLanguage: (lang: Language) => void;
  t: (key: string) => string;
  dir: "ltr" | "rtl";
}

const LanguageContext = createContext<LanguageContextType | null>(null);

function getInitialLanguage(): Language {
  if (typeof window !== "undefined") {
    const stored = localStorage.getItem("bacmr-lang");
    if (stored === "en" || stored === "fr" || stored === "ar") {
      return stored;
    }
  }
  return "en";
}

export function LanguageProvider({ children }: { children: ReactNode }) {
  const [language, setLanguageState] = useState<Language>(getInitialLanguage);

  const setLanguage = useCallback((lang: Language) => {
    setLanguageState(lang);
    localStorage.setItem("bacmr-lang", lang);
  }, []);

  const t = useCallback(
    (key: string): string => {
      return translations[language]?.[key] ?? key;
    },
    [language],
  );

  const dir = language === "ar" ? "rtl" : "ltr";

  return (
    <LanguageContext.Provider value={{ language, setLanguage, t, dir }}>
      {children}
    </LanguageContext.Provider>
  );
}

export function useLanguage() {
  const context = useContext(LanguageContext);
  if (!context) {
    throw new Error("useLanguage must be used within a LanguageProvider");
  }
  return context;
}
